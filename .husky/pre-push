#!/bin/sh

# ==============================================
# Pre-push hook: PeÅ‚ne sprawdzenia przed pushem do repo
# Uruchamia wolniejsze operacje: E2E + build produkcyjny
# ==============================================

echo "ğŸš€ Uruchamiam peÅ‚ne sprawdzenia przed pushem..."

# 1. Testy E2E (playwright)
echo ""
echo "ğŸ­ Krok 1/2: Testy E2E (playwright)..."
npm run test:e2e
if [ $? -ne 0 ]; then
  echo "âŒ Testy E2E: NiektÃ³re testy nie przeszÅ‚y."
  echo "âŒ Push zablokowany. Napraw testy przed pushem."
  exit 1
fi
echo "âœ… Testy E2E: OK"

# 2. Build produkcyjny (Next.js)
echo ""
echo "ğŸ—ï¸  Krok 2/2: Budowanie aplikacji produkcyjnej..."
npm run build
if [ $? -ne 0 ]; then
  echo "âŒ Build: Budowanie aplikacji nie powiodÅ‚o siÄ™."
  echo "âŒ Push zablokowany. Napraw bÅ‚Ä™dy przed pushem."
  exit 1
fi
echo "âœ… Build produkcyjny: OK"

# Wszystko OK
echo ""
echo "âœ… =========================================="
echo "âœ… Pre-push: Wszystkie sprawdzenia przeszÅ‚y!"
echo "âœ… Aplikacja gotowa do deploymentu na Vercel!"
echo "âœ… =========================================="
